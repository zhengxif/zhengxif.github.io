<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="415px" preserveAspectRatio="none" style="width:1195px;height:415px;" version="1.1" viewBox="0 0 1195 415" width="1195px" zoomAndPan="magnify"><defs><filter height="300%" id="f18d6wrg7kdjv2" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FEFECE" filter="url(#f18d6wrg7kdjv2)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="158" x="560.5" y="8"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="560.5" x2="718.5" y1="34.2969" y2="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="618.5" y="25.9951">MVVM</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="138" x="565.5" y="50.4355">new Vue({...options})</text><rect fill="#FEFECE" filter="url(#f18d6wrg7kdjv2)" height="78.2031" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="319" x="480" y="146"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="480" x2="799" y1="172.2969" y2="172.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="598" y="163.9951">创建基类Vue</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="242" x="485" y="188.4355">1、模版编译:new Compiler(this.$el, this)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="259" x="485" y="202.4043">2、数据劫持:new Observer({...this.$data})</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="299" x="485" y="216.373">3、把数据获取操作，vm上的取值操作代理到vm.$data</text><rect fill="#FEFECE" filter="url(#f18d6wrg7kdjv2)" height="92.1719" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="447" x="420" y="312"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="420" x2="867" y1="338.2969" y2="338.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="615.5" y="329.9951">数据劫持</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="427" x="425" y="354.4355">1、利用Object.defineProperty(),给每个对象进行数据拦截增加get、set方法</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="300" x="425" y="368.4043">2、在数据劫持时，给每一属性创建被观察者new Dep()</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="396" x="425" y="382.373">3、在属性的get方法中,Dep.target &amp;&amp; dep.subs.push(Dep.target)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="200" x="425" y="396.3418">4、在属性的set方法中,dep.notify()</text><rect fill="#FEFECE" filter="url(#f18d6wrg7kdjv2)" height="134.0781" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="349" x="834" y="118"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="834" x2="1183" y1="144.2969" y2="144.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="84" x="966.5" y="135.9951">编译虚拟节点</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="230" x="839" y="160.4355">1、创建虚拟节点createFrageElement()</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="269" x="839" y="174.4043">2、把真实dom通过appendChild转移到虚拟节点</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="320" x="839" y="188.373">3、遍历每个元素节点拿到v-model属性，进行替换赋值操作</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="294" x="839" y="202.3418">4、拿到节点的textContent，匹配{{}}进行赋值操作</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="329" x="839" y="216.3105">5、在给元素节点v-model属性赋值时同时创建观察者Wather</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="325" x="839" y="230.2793">6、在给文本节点每个{{xx}}赋值时同时创建观察者Wather</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="280" x="839" y="244.248">7、在给元素节点带有v-model属性的添加input事件</text><rect fill="#FEFECE" filter="url(#f18d6wrg7kdjv2)" height="92.1719" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="435" x="6" y="139"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="6" x2="441" y1="165.2969" y2="165.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="174" y="156.9951">观察者Watcher</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="415" x="11" y="181.4355">1、观察者上的get方法，把观察者与被观察者Dep关联，Dep.target = this</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="368" x="11" y="195.4043">2、观察者上的get方法，能根据表达式获取当前vm中$data的value</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="209" x="11" y="209.373">3、取完value值后Dep.target = null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="296" x="11" y="223.3418">4、观察者上有一update方法，该方法能触发传入的cb</text><rect fill="#FEFECE" filter="url(#f18d6wrg7kdjv2)" height="64.2344" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="337" x="48" y="326"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="48" x2="385" y1="352.2969" y2="352.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="174" y="343.9951">被观察者Dep</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="270" x="53" y="368.4355">1、主要起到订阅观察者，并提供notify发布的方法</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="317" x="53" y="382.4043">2、可以说是针对某个数据，绑定对应多个Wather，一对多</text><path d="M639.5,58.0997 C639.5,80.4711 639.5,113.7325 639.5,140.5905 " fill="none" id="MVVM-&gt;创建基类Vue" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="639.5,145.8717,643.5,136.8717,639.5,140.8717,635.5,136.8717,639.5,145.8717" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M640.4077,224.2564 C640.9717,248.6497 641.7029,280.2738 642.3126,306.6462 " fill="none" id="创建基类Vue-&gt;数据劫持" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="642.4329,311.8469,646.2238,302.7568,642.3173,306.8482,638.2259,302.9418,642.4329,311.8469" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M799.1357,185 C809.0019,185 818.868,185 828.7341,185 " fill="none" id="创建基类Vue-&gt;编译虚拟节点" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="833.8935,185,824.8935,181,828.8935,185,824.8935,189,833.8935,185" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M221.6241,231.3608 C220.4927,259.3227 219.0704,294.4749 218.0115,320.6453 " fill="none" id="观察者Watcher-&gt;被观察者Dep" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="217.8047,325.7548,222.1655,316.924,218.007,320.7589,214.1721,316.6003,217.8047,325.7548" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M320.0807,138.9928 C367.168,119.0463 425.3221,97.9934 480,88 C619.4675,62.5098 660.5414,57.5016 799,88 C826.844,94.1332 855.3899,104.3475 882.0976,115.9013 " fill="none" id="观察者Watcher-&gt;编译虚拟节点" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="886.7139,117.9194,880.07,110.649,882.1326,115.9164,876.8652,117.979,886.7139,117.9194" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M385.3818,358 C395.1843,358 404.9867,358 414.7892,358 " fill="none" id="被观察者Dep-&gt;数据劫持" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="419.9152,358,410.9152,354,414.9152,358,410.9152,362,419.9152,358" style="stroke: #A80036; stroke-width: 1.0;"/></g></svg>